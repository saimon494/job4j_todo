<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>ToDo</title>
</head>
<body>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        show();
        setInterval('show()', 1000);
    });

    function show() {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/todo/item'
        }).done(function (data) {
            const tbody = document.querySelector('tbody');
            const trs = document.querySelectorAll('tbody tr');
            const showAll = document.querySelector('#show_all');
            $.each(trs, function (i, e) {
                e.remove();
            });
            $.each(JSON.parse(data), function (i, e) {
                if (!showAll.checked && e.done) {
                    return;
                }
                const tr = document.createElement('tr');
                const num = document.createElement('td');
                const desc = document.createElement('td');
                const date = document.createElement('td');
                num.innerText = e.id;
                desc.innerText = e.description;
                date.innerText = e.created;
                tr.append(num);
                tr.append(desc);
                tr.append(date);
                tbody.append(tr);
            });
        }).fail(function (err) {
            alert(err);
        });
    }

    function addItem() {
        const desc = document.querySelector('#description');
        const done = document.querySelector('#done');
        if (desc.value === '') {
            alert('Добавьте задание');
            done.checked = false;
            return;
        }
        const item = {
            description: desc.value,
            done: done.checked
        };
        $.ajax({
            type: 'PUT',
            url: 'http://localhost:8080/todo/item',
            data: JSON.stringify(item),
        }).done(function (data) {
            desc.value = '';
            done.checked = false;
        }).fail(function (err) {
            alert(err);
        });
    }
</script>
<div class="container">
    <div class="row pt-3">
        <h4>ToDo</h4>
    </div>
    <div class="row-5">
        <form class="form-group row mb-0">
            <div class="form-check col-1">
                <input type="checkbox" class="form-check-input" id="done" name="done" title="Выполнено">
                <label class="form-check-label" for="done"></label>
            </div>
            <div class="form-group col-4 mb-0 pl-0">
                <label><input type="text" class="form-control" id="description"
                              placeholder="Добавить задание" name="description"></label>
            </div>
            <div class="form-group col-2 mb-0">
                <button type="button" class="btn btn-default" onclick="addItem()">Добавить</button>
            </div>
        </form>
    </div>
    <div class="row pt-3">
        <h5>Список добавленных заданий</h5>
    </div>
    <div class="row">
        <div class="form-check pb-2">
            <input type="checkbox" class="form-check-input" id="show_all" name="show_all">
            <label class="form-check-label" for="show_all">Показать все</label>
        </div>
    </div>
    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col" style="width:5%">№</th>
            <th scope="col" style="width:55%">Описание</th>
            <th scope="col" style="width:40%">Дата создания</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
</body>
</html>